<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>移动开发的专注之路</title>
    <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://qtdc1229.github.io/%E5%AE%9E%E8%B7%B5%E4%B9%8B%E8%B7%AF/2016/01/20/zhuan-zhu-yi-dong-kai-fa-zhi-lu.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">dingc'enstein</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">移动开发的专注之路</h1>
    <p class="post-meta">Jan 20, 2016</p>
  </header>

  <article class="post-content">
    <h1 id="section">移动开发的专注之路</h1>

<p>在被测试一而再再而三的打断之后，我对自己工作效率实在是忍无可忍了。怎么样才能快速构建部署提上了日程。</p>

<h3 id="section-1">移动开发的系统集成要做什么？</h3>

<p>首先我们来看看，为了专注工作我们要做些什么：</p>

<ul>
  <li>1、更好用的bug收集工具（仅仅是人工提交一个问题已经没有办法我们的需求了，客观的stack日志、操作步奏、carshReport以及截图会更加提升效率）</li>
  <li>2、提交代码后自动编译（我们现在使用了SVN，整体需要支持SVN，服务器平台需要支持xcode）</li>
  <li>3、自动打包</li>
  <li>4、快速部署平台（APP需要下载）</li>
</ul>

<h3 id="section-2">友盟错误统计</h3>

<p>bug收集工具的重要性这里就不说了大家都知道的，怎么才能更~~搞笑，搞笑。。。手残~~高效收集解决bug是个大问题。</p>

<p><strong>友盟</strong> 是我们最早使用的一个bug统计工具，<strong>友盟</strong> 只能收集崩溃日志，对于当初啥都不懂的我来说已经很高大上了。</p>

<p>他的优点。。。在现在来说只能说出现的太早了。。。当时国外的工具不怎么知道，也没这么多人普及。。。
他的缺点收集到的崩溃日志没符号表没法看。。。不够友好。。。只能收集<strong>CrashReport</strong>。</p>

<h3 id="bughd">BugHD</h3>

<p><code class="highlighter-rouge">BugHD</code>是<code class="highlighter-rouge">fir.im</code>推出的一款bug收集工具，其实他也就是<strong>友盟</strong>的扩展版。功能比较单一依然是只收集<strong>CrashReport</strong>，而且出现过一个非常不友好的事件–2015年9月前后所有安装<code class="highlighter-rouge">BugHD</code>的应用全部遭到提交失败，理由是会跳到第三方下载。。。然后被大面积的删除。</p>

<p>生不逢时也是<code class="highlighter-rouge">BugHD</code>比较悲剧的地方，因为同一时期我们发现了另一个bug收集工具 — <strong>bugtags</strong>。</p>

<h3 id="bugtags">bugtags</h3>

<p><code class="highlighter-rouge">bugtags</code>是我们最新发现的一款测试软件，也是我们现在一直在使用的。</p>

<p>他的优势在于测试人员能快速的提交有问题的页面到服务端，然后系统会自动发邮件给应用管理者，开发人员就会对该bug做出相应的措施了。</p>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/Simulator%20Screen%20Shot%202016%E5%B9%B41%E6%9C%8821%E6%97%A5%20%E4%B8%8B%E5%8D%884.01.10.png?raw=true" alt="提交bug界面" /></p>

<p>bug提交后后台显示</p>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/B6BAE36A-8C4B-4D60-AFB0-889B0C623CDE.png?raw=true" alt="后台显示" /></p>

<p>崩溃抛出问题也更好解决了，抛出的时候<code class="highlighter-rouge">bugtags</code>自动做了屏幕截图，并且将图以及<strong>CrashReport</strong>一同提交到了后台。</p>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/QQ20160121-0.png?raw=true" alt="崩溃信息" /></p>

<p>点击堆栈信息后会有堆栈的详细信息。</p>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/QQ20160121-stackinfo.png?raw=true" alt="堆栈信息" /></p>

<p>最近<code class="highlighter-rouge">bugtags</code>推出了他们的网页版，有兴趣可以试试。</p>

<h3 id="firim">fir.im</h3>

<p>找到了合适的bug收集工具我们算是能闲一闲了，但是面对一大堆机器让你安装APP的机器，你的内心估计是崩溃的。。。找到一个合适的APP仓库是需要提上日程了。</p>

<p>我们要做的很简单，就是将有Develop证书的APP发布到服务器上，能供测试人员下载。这个服务器必须支持https，而且我们还得顺利的搞到测试设备的UDID，大致就是这样。</p>

<p><code class="highlighter-rouge">fir.im</code>是最先出现在我的眼中的。</p>

<p><code class="highlighter-rouge">fir.im</code>给出的方案是这样的：</p>

<ul>
  <li>1、首先是收集UDID，先访问<a href="http://fir.im/udid">http://fir.im/udid</a>选择发送udid发送到指定邮箱，然后开发者一条一条添加到apple的设备后台里去。。。（有没有更好的办法。。。。自己写个程序？）</li>
</ul>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/IMG_0436.PNG?raw=true" alt="udid" /></p>

<ul>
  <li>2、在<code class="highlighter-rouge">fir.im</code>后台建立APP，上传APP到后台</li>
</ul>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/QQ20160121-firimapp.png?raw=true" alt="fir.im后台" /></p>

<ul>
  <li>3、<code class="highlighter-rouge">fir.im</code>给你一个短链接，这个短链接你可以任意修改最后的后缀，确定以后依然可以修改，然后你将该短链接发送给测试人员。</li>
</ul>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/QQ20160121-563b22a400fc74087200000e.png?raw=true" alt="fir.im云掌柜" /></p>

<ul>
  <li>4、测试设备访问短链接下载APP，和下载企业发布应用是一样的</li>
</ul>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/QQ20160121-dmiotinn.png?raw=true" alt="dmiotinn" /></p>

<p>最初我只是把他当作企业发布的仓库，作为一个囊中羞涩的小公司，一个CA高级认证的https证书也是需要节省的…<code class="highlighter-rouge">fir.im</code>给我们解决了https的证书问题，在全国范围内下载成功了比我们自己放在高的多。再后来发现用他的测试发布平台是非常好用的，当然 <code class="highlighter-rouge">fir.im</code> 本身就是作为测试平台去做的，现在来看也是国内做的最好的测试分发平台。</p>

<p>后来我拥有了全公司iOS设备的UDID，这个过程。。。实在是不想提起。。。好吧那我们就把测试版本也发布到<code class="highlighter-rouge">fir.im</code>上去吧，不用一个设备一个设备的安装了。</p>

<h3 id="testflight">TestFlight</h3>

<p><code class="highlighter-rouge">TestFlight</code> 是国外一个比较优秀的测试平台，后来被苹果收购了，所以现在只支持iOS平台。</p>

<p>作为苹果自己的东西自然有他的过人之处————那就是不用统计udid，但是相对应的需要你的iCloud账号。</p>

<p>过程大致如下：</p>

<ul>
  <li>在iTunes-connects中设置<code class="highlighter-rouge">TestFlight</code>，加入要发布的构建。</li>
  <li>在该APP中加入测试人员的iCloud的账号</li>
  <li>测试人员下载<code class="highlighter-rouge">TestFlight</code>应用</li>
  <li>然后在应用中登录，下载测试APP</li>
</ul>

<p>以上过程全部脑补。<strong><a href="https://github.com/wensonMaster">wency</a></strong></p>

<h3 id="travis-ci">Travis CI</h3>

<p>完成了bug管理，打包发布怎么才能将编译和以上步骤一起自动发布呢？在阅读Bolg的时候我不经意间了解到了系统集成。</p>

<p>第一次看到<code class="highlighter-rouge">Travis CI</code>是在<strong><a href="http://objccn.io/">objccn.io</a></strong>上这是一个关于Objective-C的进阶的网站。其中第六章有一篇<strong><a href="http://objccn.io/issue-6-5/">为 iOS 建立 Travis CI</a></strong>的文章。阅读了他才对为<code class="highlighter-rouge">Travis CI</code>有一点了解。</p>

<p>首先是CI，持续集成（Continuous integration）
&gt;持续集成是一种软件开发实践，即团队开发成员经常集成它们的工作，通过每个成员每天至少集成一次，也就意味着每天可能会发生多次集成。每次集成都通过自动化的构建（包括编译，发布，自动化测试）来验证，从而尽早地发现集成错误。</p>

<p><code class="highlighter-rouge">Travis CI</code>被广泛的用在github上，如果你想在自己的服务器上部署一份，对不起这不被允许。。。即使是企业版也是要他们合作，整个持续集成的过程将在<code class="highlighter-rouge">Travis CI</code>的服务器上执行。可以说他们出售的是个在线的服务。</p>

<p>如果你的是一个开源项目，或者你愿意的持续集成服务不再自己的服务器上运行，那<code class="highlighter-rouge">Travis CI</code>绝对是你不二的选择。</p>

<p>企业级的他还要收费的。。。我只能选择其他路径了。</p>

<h3 id="jenkins">Jenkins</h3>

<p><code class="highlighter-rouge">Jenkins</code>也是一款经典的持续集成软件。</p>

<p>他可以安装在自己的服务器上，这个比较和我的胃口。</p>

<p>这里先说一下之CI主机必须满足2个要求：速度快与容量大。所以<code class="highlighter-rouge">Travis CI</code>能提供这样的服务，与他强大的服务器组是分不开的。首先我想到的是部署在咱们的公司服务器上，但是很快就发现，这是一个无法完成的动作。。。为什么？CentOS怎么运行XCode 的 commodline ?</p>

<p>好吧既然这样就先部署在我的电脑上好了，至少保证他能运行。</p>

<p>简单介绍一下<code class="highlighter-rouge">Jenkins</code>的安装，首先保证有Java环境，如果没有安装一个JDK最新版的好了。然后在Terminal中键入以下代码：</p>

<p><code class="highlighter-rouge">
$ brew install jenkins
</code>
没有安装过brew的自行脑补。
安装完成后键入</p>

<p><code class="highlighter-rouge">
$ java -jar */jenkins.war
</code></p>

<p>然后在浏览器中键入<a href="http://localhost:8080/">http://localhost:8080/</a>，可以看到<code class="highlighter-rouge">Jenkins</code>的主界面</p>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/QQ20160121-Jenkins.png?raw=true" alt="Jenkins主界面" /></p>

<p>点击新建然后选择自由风格的软件项目</p>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/B9F00738-67AC-4BC1-A771-C99666E076C9.png?raw=true" alt="Jenkins新建" /></p>

<p>ok后会进入配置页面</p>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/8CF5649F-696F-4FDF-8750-C8F839628DAD.png?raw=true" alt="Jenkins项目配置" /></p>

<p>这里说明一下，Jenkins跟大部分应用一样有大量的插件，比如在图中看到我们看到svn账号管理这个插件就是<strong>Credentials Plugin</strong>，如果要运行iOS就要安装相应的iOS编译相关的XCode比如<strong>CocoaPods Jenkins Integration</strong>、<strong>Xcode integration</strong>、<strong>Keychains and Provisioning Profiles Management</strong>等。以上3个插件加上<strong>fir-plugin</strong>是我们必要的，你可以根据不同的构建选择不同的插件。</p>

<p>这个iOS构建我添加了<strong>Xcode integration</strong>，用于控制iOS的编译</p>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/B01794F7-1803-433F-97D7-FC355ECFA4A9.png?raw=true" alt="Jenkins iOS设置1" /></p>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/B0BF8F87-6419-4ACE-989B-BDC1CDCD205B.png?raw=true" alt="Jenkins iOS设置2" /></p>

<p>这里大部分的数据都在环境变量选项已经设置过了，简单贴一下环境变量的设置：</p>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/18220E3E-16CF-43BE-A531-82E776798120.png?raw=true" alt="Jenkins 环境变量设置" /></p>

<p>这里注意按照自己的路径设置，相对来说设置还是比较简单的。</p>

<p>比较麻烦的是关于keychain的设置，<strong>Keychains and Provisioning Profiles Management</strong>插件是必要的，安装完之后我们就可以继续设置工程了。</p>

<p>首先要在钥匙串中导出keychain，然后在<code class="highlighter-rouge">Jenkins</code>的系统管理中找到<strong>Keychains and Provisioning Profiles Management</strong>选项。在这里选择上传文件上传keychain，然后点击添加证书填入要选择的签名证书名称。然后填写<strong>Provisioning Profiles</strong>文件的名称以及<strong>UUID</strong>这里path可以设置为系统默认的path一般xcode会把预编译文件存放在这个目录下。</p>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/D22F6C20-ACCB-44CF-8315-0289A2C7EBB6.png?raw=true" alt="Jenkins Manage Keychain and Provisioning Profile files" /></p>

<p>在系统管理中设置完keychain后就可在任务的设置中继续设置了。添加keychain然后在keychain选项可以选择你刚才设置的keychain，然后选择需要的<strong>Code Signing Identity</strong>，<strong>Provisioning Profiles</strong>也是同理勾选<strong>Mobile Provisioning Profiles</strong>后然后设置。</p>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/70E28929-C858-4336-BC01-1882B3728039.png?raw=true" alt="Jenkins Keychains and Code Signing Identities" /></p>

<p>ok，到此为止就可以进行构建了。</p>

<p>我在自己构建的时候遇到了一种情况，打包的时候失败了，构建日志告诉我<strong>CODE_SIGN_RESOURCE_RULES_PATH</strong>没有设置，这个是在.xcodeproj文件中buildSetting里设置的，但是提交appstore的是不需要<strong>CODE_SIGN_RESOURCE_RULES</strong>，如果遇到这种情况记得设置。</p>

<p>最后在<code class="highlighter-rouge">fir.im</code>的官网下载插件，填写<strong>API Token</strong>和包地址，上传到fir即可。</p>

<p><img src="https://github.com/qtdc1229/tutorial/blob/newbranch/resources/9AD8E605-0FAA-4B46-A095-B6B29193734D.png?raw=true" alt="Jenkins fir.im" /></p>

<p>如何自动化？这里有多种形式，设置都在<strong>构建触发器</strong>模块中
* 触发远程构建 (例如,使用脚本)</p>

<ul>
  <li>
    <p>添加svn的hock文件，每次提交时根据我们的关键字会自动构建。</p>
  </li>
  <li>
    <p>选择<strong>Poll SCM</strong>然后填写自己定义的日程。规则如下：</p>
  </li>
</ul>

<blockquote>
  <p>MINUTE HOUR DOM MONTH DOW</p>
</blockquote>

<blockquote>
  <p>MINUTE 一小时内多少分钟（0-59）</p>
</blockquote>

<blockquote>
  <p>HOUR    一天内多少小时（0-23小时）</p>
</blockquote>

<blockquote>
  <p>DOM     一个月内多少天（1-31）</p>
</blockquote>

<blockquote>
  <p>MONTH  每月（1-12）</p>
</blockquote>

<blockquote>
  <p>DOW     星期几（0-7），其中0和7都表示周日。</p>
</blockquote>

<blockquote>
  <p>如果要指定一个字段允许多个值，就按下面提供的操作步骤(指定)。</p>
</blockquote>

<blockquote>
  <p>优先顺序如下：</p>
</blockquote>

<blockquote>
  <p>‘*’                       可用来指定所有有效的值。</p>
</blockquote>

<blockquote>
  <p>‘M-N’                   可以用来指定一个范围,比如“1-5”</p>
</blockquote>

<blockquote>
  <p>‘M-N/X’或’<em>/X’      可用于在指定范围内跳跃一个X的值，比如在MINUTE字段中”</em>/15”表示”0,15,30,45”，”1-6/2”表示”1,3,5”。</p>
</blockquote>

<blockquote>
  <p>‘A,B,…,Z’            可以用来指定多个值，比如“0,30”或“1,3,5”。</p>
</blockquote>

<blockquote>
  <p>任何空白行和’#’开始的行都将表示为注释而不予理睬。</p>
</blockquote>

<blockquote>
  <p>此外，’‘@yearly’, ‘@annually’, ‘@monthly’, ‘@weekly’, ‘@daily’, ‘@midnight’,  ‘@hourly’都是支持的 。</p>
</blockquote>

<blockquote>
  <p>举例说明：</p>
</blockquote>

<blockquote>
  <p>＃每分钟</p>
</blockquote>

<blockquote>
  <p><code class="highlighter-rouge">
* * * * *
</code></p>
</blockquote>

<blockquote>
  <p>＃每一小时后第5分钟</p>
</blockquote>

<blockquote>
  <p><code class="highlighter-rouge">
5 * * * *
</code></p>
</blockquote>

<h3 id="section-3">小结</h3>

<p>公司比较小，之前也很有程序构建上的经验,不过这是一个机会能够一步一步去实践，完成从无到有，从有到强的过程。</p>

<h3 id="section-4">参考</h3>
<p><a href="https://kkbox.codes/archives/2015/07/03/kkbox-ios-jenkins/">KKBOX iOS 開發過程中使用的 Jenkins 環境</a></p>

<p><a href="https://www.built.io/blog/2014/10/how-to-set-up-customized-jenkins-for-ios/">How to Set Up Customized Jenkins for iOS</a></p>

<p><a href="http://blog.csdn.net/ilyzj/article/details/8123150">Hudson poll scm 时间格式说明</a></p>

<p><a href="http://rannie.github.io/ios/2014/12/29/xcodebuild-jenkins-ci.html">使用 Xcodebuild + Jenkins + Apache 做 iOS 持续集成</a></p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">dingc'enstein</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>dingc'enstein</li>
          <li><a href="mailto:dc328466990@gmail.com">dc328466990@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/dingc">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">dingc</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/jekyllrb">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">jekyllrb</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
